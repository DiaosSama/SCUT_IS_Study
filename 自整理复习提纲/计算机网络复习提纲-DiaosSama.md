https://github.com/DiaosSama/SCUT_IS_Study

# 第一章

### 计算机网络
1. 定义：自主计算机的互联集合
2. 互联网络：计算机网络的互相联接
3. 拓扑：信道的分布方式（总线型、星型、环型、树型和网状）
4. 协议：一系列规则和约定的规范性描述，它控制网络中的设备如何进行信息交换
5. 点到点：机器间的直接连接
6. 端到端：信源机和信宿机之间直接通信，好像拥有一条直接的线路
7. 通信子网包括网络节点和通信链路

### 网络硬件
1. 个域网（PAN）：一米见方
2. 局域网（LAN）：10-1000m 
3. 城域网（MAN）：同一座城市 10km
4. 广域网（WAN）：同一个国家 同一块大陆
5. 互联网（Internet）

### 参考模型
1. OSI参考模型（开放系统互联）
  - 应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

  ① 物理层
    - 关注在一条通信信道上传输原始比特

  ② 数据链路层
    - **有帧头和帧尾**
    - 主要任务：将一个原始的传输设施转变成一条没有漏检传输错误的线路

层次  | PDU
------- | -----
物理层 | 比特（bit）
数据链路层 | 帧（frame）
网络层 | 数据包（packet）
传输层 | TPDU
会话层 | SPDU
表示层 | PPDU
应用层 | APDU

2. TCP/IP参考模型
  - 链路层、互联网层、传输层、应用层

  ① 互联网层
    - 定义了正式的分组格式和协议，即IP协议，每个IP包的路由问题是互联网层要解决的问题
    - 每个IP包独自寻径

  ② 传输层
    - 定义了两个端到端的协议：TCP、UDP

    - **缺点：**
      - 没有区分服务、接口和协议的概念
      - 不是通用模型
      - 主机至网络层不是常规意义上的层
      - 没有区分物理层和数据链路层
      - 有些协议的实现比较草率

### 因特网
1. ARPANET
- 由高级计划研究局（ARPA）建立

2. NSFNET
- 由美国国家科学基金会（NSF）建立

### Internet标准领域有影响力的组织
1. Internet活动委员会（IAB）（ARPANET时期）--> Internet体系结构委员会
- 技术报告——请求注释文档（RFC, Request For Comments）
- RFC1922 中国最早参与

2. Internet研究任务组（IRTF）
3. Internet工程任务组（IETF）
4. W3C（万维网联盟）

### 度量单位
速度以10为基数，容量以2为基数

# 第二章

### 信道的最大数据速率
1. 奈奎斯特定理（理想信道，无噪声）
$$
最大数据传输率 = 2Blog_{2}V
$$
  - 其中B为带宽（2B为采样次数），V为离散等级（二进制中仅为0、1两级）


2. 香农定理（有噪声信道）
$$
最大传输速率 = Blog_{2}(1+S/N)
$$
  - 其中B为带宽，S/N为信噪比
  - 噪声常用分贝为单位，分贝与信噪比的转化公式为
$$
分贝 = 10log_{10}(S/N)
$$

**带宽可以是一个范围**

### 双绞线
1. 定义：双绞线是由两根具有绝缘层的铜导线按一定密度，逆时针方向绞合而成的。两根线绞在一起后，不同电线产生的干扰波会互相抵消，从而显著降低电线的辐射。可以消除近端串扰。
2. 绞距（扭距）：一般地，绞距越紧（小），越均匀，则抵消效果越好，传输性能越好
3. 分类：
  - 非屏蔽双绞线（UTP）
    - 五类UTP可以提供10M、100M的数字带宽，分别使用了两对双绞线，分别用于收、发
    - 1000M以太网里用到了全部的4对线
    - 广泛用于局域网
    - **最大传输距离：100m**
    - **优点：成本低、尺寸小、易于安装**
    - **缺点：易受干扰、传输距离性能受到绞距影响**
  - 屏蔽双绞线（STP）
    - **优点：抗EMI / RFI干扰**
    - **缺点：成本高、安装不易**
4. 直通线：用于连接非同类设备（比如交换机和PC）
5. 交叉线：用于连接同类设备（PC和PC、PC和路由、路由和路由）

### 光纤
1. 定义：光导纤维的简称。由极细的玻璃纤维构成，把光封闭在其中并沿轴向进行传播。
2. 优点：重量轻、损耗低、不受电磁辐射干扰、传输频带宽、通信容量大
3. 缺点：昂贵、易断裂
4. 分类：
  - 单模光纤
    - 以单一模式传输，激光产生的单束光
    - **纤心细、高带宽、长距离、成本高**
    - **运行波长为850nm或1300nm（波长小）**
    - 内径8-10μm，外径125μm
  - 多模光纤
    - 以多个模式同时传输，LED产生的多束光
    - **纤心粗、低带宽、短距离、成本低**
    - **运行波长为1310nm或1550nm（波长长）**
    - 内径62.5μm，外径125μm

## 数字调制
1. 定义：比特与代表它们的信号之间的转换过程称为数字调制（为了发送数字信息需设法用模拟信号来表示比特）
2. 分类：
  - 基带传输
  - 通带传输

### 波特率和比特率
1. 关系：
$$
C = Blog_{2}n
$$
  - 其中，C：比特率；B：波特率；n：调制电平数或线路状态数（波特率一般为带宽x2）

### 基带传输
1. 定义：直接将数据比特转化为信号
2. 编码方案：
  - 不归零（NRZ）:逻辑1为高电平，逻辑0为低电平
  - 不归零逆转（NRZI）：出现逻辑1则电平跳变，否则电平不变
  - 曼彻斯特编码（Manchester）：逻辑1代表电平高到低，逻辑0代表电平低到高
  - 二级编码：逻辑0在中间，逻辑1上下反复变换

### 通带传输
1. 定义：通过调节信号的振幅、相位或频率来传输比特
2. 信号星座：
$$
传输比特数 = log_{2}n
$$
  - 其中n为星座图符号数，名称为QAM-n

## 多路复用
1. 目的：让多用户共享同一根信道
2. 分类：
  - 频分复用（FDM）
  - 时分复用（TDM）
  - 码分复用（CDM）

### 频分复用（FDM）
1. 方式：将频谱分为几个频段，每个用户完全拥有其中的一个频段来发送自己的信号
2. 保护带：比语音通信所需多出来的那部分频带称为保护带，它使信道之间完全隔离
3. 正交频分复用（OFDM）
4. 波分多路复用（WDM）：在光纤上复用信号

### 时分复用（TDM）
1. 方式：每个用户周期性地获得整个带宽非常短的一个时间
2. 保护时间：适应时钟的微小变化
3. 统计时分复用：根据统计需求分配时间片，提高利用率
4. 实例：脉冲编码调制（PCM）

#### 脉冲编码调制（PCM）
1. 编码解码器（codec）：将模拟信号数字化，每秒采集8000个样值
2. 电话系统内的时间间隔均为125微秒的倍数（0.125 = 1 / 8000），所以语音通话的未压缩数据率为每125微秒8比特，或64kbps
3. 实例：
  - T1载波
    - **包含24条复用在一起的语音信道，所以每帧包含24\*8=192比特，再加上额外一个比特用于控制**
    - 所以125微秒产生193比特，得到数据传输率 1.544Mbps
    - 其中8kbps用于信令控制（1 / 0.125 = 8kbps)
  - E1载波
    - **包含32条复用在一起的语音信道，所以每帧包含32\*8=256比特**
    - **其中30个信道用于传输信息，两个信道用作信令**
    - 125微秒产生256比特，得数据传输率 2.048Mbps
  - SONET（同步光网络）
    - **每一帧为90列宽、9行高的矩形，总共9\*90=810字节，810\*8=6480比特**
    - 125微秒传输6480比特，得到传输速率 51.84Mbps（这是最基本的SONET信道，称为STS-1，同步传输信号-1）
    - **每一帧的前3列用于传输系统管理信息（前3行包含段开销。后6行包含线路开销），剩下的87列中第一列又用与路径开销**
    - 所以SPE（同步有效载荷信封）为：87\*9\*8\*8000=50.112Mbps
    - 用户速率为：86\*9\*8\*8000=49.536Mbps
    - 多路复用层次：OC-n即为OC-1的n倍，直接相乘即可（结尾带c省略路径开销）

### 码分复用（CDM）
1. 方式：每个用户拥有一个唯一的码片序列
2. **计算来自某个用户发送的信息，将复用后的信息与该用户的序列计算归一化内积，结果为1则发送了逻辑1，结果为0则没有发送任何信息，结果为-1则发送了逻辑0（前提是每个用户的码片序列两两正交）**

## 物理层设备
1. 被动部件 / 设备：
  - 接线板
  - 插头
  - 插座
  - 电缆
2. 主动部件 / 设备：
  - 转发器
  - 中继器
  - 集线器

### 收发器
1. 功能：将一种形式的信号转变成另一种信号

### 中继器
1. 功能：再生信号（去噪、放大）使线缆可以延伸得更远
2. 注意：不能过滤流量

### 集线器
1. 定义：多端口的中继器
2. 功能：再生信号
3. 一般作为星型拓扑的中心（中继器和集线器会扩大冲突域）

# 第三章

### 数据链路层
1. 功能：
  - 为网络层提供服务，良好的服务接口
  - 保证数据传输的有效、可靠
2. 服务种类：
  - 无确认的无连接服务（主要用于局域网，适用于实时通信）
  - 有确认的无连接服务（无线通信）
  - 有确认的面向连接服务（卫星信道、长途电话）

### 成帧
1. 定义：将原始的位流分散到离散的帧中，叫成帧
2. 方式：
  - 字符计数法（不常用，因为无法恢复）
  - 带字节/字符填充的标志字节法（缺点：只能使用8比特的字节）
  - 比特填充的比特标志法（01111110作为标志字节，发送方发现五个连续1则填充一个0）
  - 物理层编码违例法（使用冗余的码作为边界的标志，因为在数据中一定不会出现）

### 差错控制
1. 类型
  - 单个错误：分散在各块中
  - 突发错误：集中在某个块中（突发比单个更难于纠正）
2. 差错处理：
  - 纠错码
  - 检错码

#### 海明距离
1. 定义：两个码字之间不同位的数目
2. **全部码字的海明距离：全部码子中任意两个码字之间海明距离的最小值**
3. 意义：如果海明距离为d，则一个码字需要发生d位错误才能变成另一个码字
4. **d+1位海明距离的编码能检测出d位差错，2d+1位海明距离的编码能纠正d位差错**

### 检错码
#### 奇偶校验码
1. 奇校验：使码字中1的个数为奇数
2. 偶校验：使码字中1的个数为偶数

#### 互联网校验和
1. 生成：将发送的消息按16位一组分好，相加，高位的进位溢出循环加到低位上，获得的结果**取反**就是校验和
2. 检验：将发送过来的信息和校验和全部相加，获得结果**取反**，若全为0则检验成功，否则有错误
3. 特点：能检出高至n位的突发错误

#### 循环冗余校验码（CRC）
1. 生成（原码字为m位）：
  - 首先，双方规定一个生成多项式G(x)，阶数为r（r<m)（此时G(x)有5位数）
  - 然后再原码字后面补r个0，使得原码字有(m+r)位
  - 做除法（注意2进制除法全为异或，无借位）
  - 获得的余数与原码字相加获得循环冗余码（现在码字为 m+r 位）
2. 检验：最后生成的码字能够被G(x)整除即校验成功
3. **特点：可以检测到所有长度小于等于r的突发错误**


### 纠错码
#### 求可以纠一位错的码字所需的校验码位数
设m为消息位位数，r为校验位位数，n = m+r
有 
$$
(n+1)*2^{m} \leq 2^{n}
$$
推出
$$
(m+r+1) \leq 2^{r}
$$

#### 海明码
- 将某一位数据位的编号展开成2的乘幂的和，那末每一项所对应的位即为该数据位的校验位(收方使用)。
  - 校验位1的检验集合为所有奇数位
  - 校验位2的检验集合：2、3、6、7、10、11...
  - 校验位4的检验集合：4、5、6、7...
- 使用偶校验，一个校验集里1的个数为偶数
- **纠错方式：检验各校验位，出错便加入计数器，最终得到的和就为出错的位**

### 基本数据链路协议
- 无限制的单工协议
- 单工停-等协议
- 有噪声信道的单工协议

#### 无限制的单工协议（协议1）
- 数据单向传送
- 收发双方的网络层都处于就绪状态
- 处理时间忽略不计
- 可用缓存空间无限大
- 永远不会损坏或者丢失帧

#### 单工的停-等协议（协议2）
1. 问题：如何避免收方被涌入的数据淹没
2. 解决方法：接收方发回一个哑帧，表明收方允许接受数据，此时再发送下一帧

#### 有噪声信道的单工协议（协议3）
1. 问题：
  - 接收方检测到错误帧如何通知发送方？如何恢复正确帧？
  - 数据帧或确认帧丢失如何解决？
  - 收到重复帧如何解决？
2. 解决方法：确认；重发；计时器；帧序号
3. 实际方案：**自动重复请求（ARQ）或支持重传的肯定确认协议（PAR）**

#### 滑动窗口
- 每个待发送帧被赋予一个序列号seq（取值范围为0-2^n-1，n位字段）
- 建立缓冲区
  - 发送窗口：**缓存已发送、待确认的帧**
    - 顺序接收来自网络层的分组，成帧，赋予序列号
    - 最多保存w个已经发送、等待确认的帧
    - 窗口达到最大值w时强制关闭网络层
  - 接收窗口：**缓存期待接收的帧（序号）**
    - 对进入窗口的帧顺序提交网络层，产生确认
    - 落在窗口外的帧被丢弃

#### 一位滑动窗口协议（协议4）
1. 窗口设置：
  - 滑动窗口最大值：MAX_SEQ = 1
  - 通信双方初始值：seq = 0，ack = 1（期待接收seq = 0）
2. 窗口滑动机制
  - A首先发送数据帧（seq = 0，ack = 1， A0）
  - B收到A0，发送捎带确认帧（seq = 0， ack = 0， B0）
  - A收到对A0的确认，滑动窗口，发送帧（seq = 1，ack = 0，A1）
3. 特点：
  - 序列号seq和确认值ack在0、1间交替
  - 滑动窗口长度 w = 1，收到确认才移动窗口
  - 保证按顺序将接受到的正确帧只一次上交网络层
4. **信道利用率** 
  - 信道传输速率：b bps
  - 每帧大小：k bits
  - 来回时间（RTT）：R sec
$$
  信道利用率 = k/(k+bR)
$$
  令 Tf = k/b（每帧传输时间），可得
$$
  信道利用率 = T_{f}/(T_{f}+R)
$$
5. 提高信道利用率
  - 增加滑动窗口长度w
$$
信道利用率 = w*k/(k+bR)或w*T_{f}/(T_{f}+R)
$$

#### 回退N帧协议（协议5）
1. 目的：解决为了提高信道利用率增加滑动窗口所导致的发送错误问题
2. 接收方的接收策略：丢弃错帧，其后续帧因不是期望接收帧也丢弃（接收窗口为1）
3. 发送方的重传策略：缓存在发送窗口中的出错帧及其后续帧全部重发（发送方需要缓冲区）
4. 发送方滑动窗口长度w的选择：**W = MAX_SEQ**（为了防止累计确认出现问题）
5. 接收方滑动窗口长度：**W = 1**

#### 选择重传协议（协议6）
1. 接收方的接受策略：丢弃错帧，缓存后续正确接收帧（接收方需要缓冲区）
2. 发送方的重传策略：只重发出错帧
3. 滑动窗口长度w的选择：**W = (MAX_SEQ + 1) / 2**（接收窗口和发送窗口相同）

#### 否定确认NAK
- 对出错帧回送否定确认，使发方不再等到超时再重传，加快出错帧的重传

#### 累计确认
- n号帧的确认到达时，暗含之前的所有帧都被确认

### 实例：点到点协议PPP
- 采用字节填充的标志字节法（0x7E，01111110），转义字节为0x7D并将原码与0x20进行XOR
- “无序号帧”（无确认无连接）用于承载IP分组
- 采用校验和检错
- 链路控制协议LCP
- 网络控制协议NCP
- **工作过程**
  - 1. 初始状态
  - 2. 建立连接
  - 3. 选项协商
  - 4. 身份认证
  - 5. 配置网络
  - 6. 数据传输
  - 7. 释放链路

#### LCP
- 提供了建立、配置、维护和种植点对点链接的方法
- LCP的过程按以下四个阶段进行：
  - 链路的建立和配置协调
  - 链路质量检测
  - 网络层协议配置阶段
  - 关闭链路
- LCP帧的类型有三种：
  - 链路建立帧：建立和配置链路
  - 链路终止帧：终止链路
  - 链路维护帧：管理、维护链路

#### PAP和CHAP特点

# 第四章
### 多路访问协议
- 随机访问协议
  - 特点：站点争用信道，可能出现站点之间的冲突
  - 典型的随机访问协议：
    - ALOHA协议
      - 纯ALOHA；分隙（分槽）ALOHA
    - CSMA协议
    - CSMA / CD协议
- 受控访问协议
  - 特点：站点被分配占用信道，无冲突

#### 纯ALOHA协议
1. 工作原理：
  - 任何一个站都可以在帧生成后立即发型（可能冲突），并通过信号的反馈，检测信道，以确定发送是否成功。如果发送失败，则经随机延迟后再发送
  - 每个站点可以在任意时间发送数据（不关心信道是否已被占用）
  - 两个以上站点都在发送数据时就会发生冲突
2. 数学描述：
  - 纯ALOHA的冲突时间为2t（ t 为发送一帧所需的时间）
  - 设G为信道中每帧时的平均帧数，P0为一帧没有遭受冲突的概率，S为吞吐量（代表在发送时间内发送成功的平均帧数，在0~1之间），有
$$
S = GP_{0} = Ge^{-2G}
$$
  - **最大吞吐量出现在 G = 0.5 时，大约为0.184，即信道利用率最高为18.4%**

#### 分槽ALOHA协议
1. 工作原理：
  - 分析ALOHA是把时间分成时隙（时间片）
  - 时隙的长度对应一帧的传输时间
  - 新帧的产生是随机的，但是不允许随机发送，凡帧的发送必须在时隙的起点
  - 冲突只发生在时隙的起点，冲突发生只浪费一个时隙
2. 数学描述
  - 分槽ALOHA的冲突时间为 t（ t 为发送一帧所需的时间）
  - 设G为信道中每帧时的平均帧数，P0为一帧没有遭受冲突的概率，S为吞吐量（代表在发送时间内发送成功的平均帧数，在0~1之间），有
$$
S = GP_{0} = Ge^{-G}
$$
  - **最大吞吐量出现在 G = 1 时，大约为0.368，即信道利用率最高为36.8%（为纯ALOHA S值的两倍）**

#### 载波侦听多路访问协议CSMA
1. 分类：
  - 非持续式（空闲则发送，否则等待一个随机分布的时间，重复之前的步骤）
  - 持续式
    - 1-持续CSMA（空闲则发送，否则持续侦听，一旦空闲则发送）
    - p-持续CSMA（空闲则以p的概率发送，1-p的概率延迟一个时间片，否则持续侦听，一旦空闲则重复之前的步骤）

#### 冲突窗口
- 发生冲突时间的上限，即发送站发出帧后能检测到碰撞的最长时间， 数值上等于最远两站传播时间的两倍，即2T

#### 带冲突检测的CSMA（CSMA/CD）
- “先听后发、边发边听”
- 特点
  - 经侦听，如果介质空闲，则发送。
  - 如果介质忙，持续侦听，一旦空闲立即发送
  - 如果发生冲突，等待一个随机分布的时间再重复步骤1
- 冲突检测的要求 
  - 时隙宽度 = 最大冲突检测时间（保证在一个时隙内能够检测到最远距离的冲突）
  - 发送有效帧的时间 >= 最大冲突检测时间（防止因在发生冲突时已完成短帧发送而造成的异常情况）

### 以太网
1. 分类：
  - 经典以太网
    - 3M~10Mbps
    - 不再使用
  - 交换式以太网
    - 10M，100M，1G
    - 广泛使用
2. 线缆命名规则
  - 10Base2（IEEE 802.3a）
    - 10：传输带宽
    - Base：基带传输
    - 2：支持的分段长度（100m为单位）
3. 编码方式：曼彻斯特编码
4. IEEE 802.3 与以太网（DIX）帧的格式不同
  - 0-7字节：前导码（10101010的序列，802.3最后两位为11）
  - 8-13字节：目的地址
  - 14-19字节：源地址
  - 20-21字节：
    - 802.3：长度字段**（帧的最小长度64字节，最大长度1518字节，不包含先导码）**（46+18、1500+18）
    - DIX：指明帧内包含的数据包所用的协议
    - （若字段值小于等于1536，则是长度字段，大于1536则表示类型字段）
  - 数据字段：0-1500字节
  - 填充字段：0-46字节
  - 校验和：4字节(CRC)
5. 访问控制技术：CSMA / CD

#### 二进制指数后退
- i 次冲突后，等待的时隙数从（0 ~ 2^i-1）中随机选择
  - 0 < i <= 10时，取（0 ~ 2^i-1）
  - 10 < i < 16时，取（0 ~ 1023）
  - i > 16时，放弃发送

### 数据链路层交换（二层交换）

#### 网桥
1. 目的：将不同的LAN连接起来
2. 功能：工作在DLL层，通过检查MAC地址做出转发帧的决策（若两个网络帧格式不同会拆包重新封装）
3. 动作：
  - 泛洪（Flooding）
  - 转发（Forwarding）
  - 丢弃（Discarding）
4. 算法：逆向学习，扩散算法
5. 可以隔离冲突域

#### 生成树网桥
- 为了可靠性，引入冗余链路
- 但产生了拓扑环路，造成了无休止循环的问题
- 解决方法就是将互联的网络在逻辑上构成生成树的拓扑结构
- 生成逻辑上无回路的树，但不保证路径最优

#### 虚拟局域网
- 一个VLAN对应一个广播域
- VLAN可使用二层交换机实现广播域的分割
- 当一个VLAN跨越几个交换机时，使用802.1Q穿越连接交换机的干线

# 第五章

### 网络层
1. 功能：将分组从源机一路送到目的机
2. 提供的服务：
  - 面向连接的服务：X.25，ATM（虚电路网络）
  - 无连接的服务：IP（数据报网络）

### 路由表的建立
- 静态路由
  - 由管理员手工配置
- 动态路由
  - 路由选择算法
    - 距离矢量路由选择（DV）
    - 链路状态路由选择（LS）

#### 静态路由
- 管理员手工配置的路由
  - 适合小型、静态的网络，开销小
  - 缺省路由：默认路径，找不到路的时候可以从这里通过
    - 避免错误丢包
    - 缩减路由表的规模
    - 减少路由器的运行负担

#### 动态路由
- 动态路由：由路由选择协议动态地建立、更新和维护的路由
  - 适合大型的、经常变动的网络，需要维护开销
  - 减少了网络管理员的负担

### 路由选择算法
1. 分类：
  - 静态算法
  - 动态算法
2. 设计目标：正确性、简单性、健壮性、稳定性、公平性和最优性

#### 最优化原则
- 如果一个路由器J处在路由器I到路由器K的最优路径上，那么，从路由器J到路由器K的最优路径也在同样的这条路径上

#### 汇集树
- 从所有的源到一个制定目标的最优路径的集合构成的一棵以目标节点为根的树

#### 静态路由算法
##### 最短路径算法
- Dijkstra算法

##### 泛洪算法
- 为解决重复分组：
  - 在分组头增加一个计数器，经过一个节点，计数减一，为零时丢弃报文
  - 每个节点设立登记表，分组第二次到达时丢弃

#### 动态路由算法
##### 距离矢量路由（DV）
- 实例：RIP
- 方式：每个路由器维护一张表，表中列出了当前已知的到每个目标的最佳距离，以及为了到达那个目标，应该从哪个目标转发的线路
- 常被用于小型网络
- 特点
  - 优点
    - 简单
  - 缺点
    - 交换的信息太大
    - 路由信息传播慢，可能导致路径信息不一致
    - 收敛慢，度量计数到无穷
    - 不适合大型的网络
- **以跳数（hop）作为度量，当超过15跳被认为不可达**
- 默认30秒交换一次矢量信息
- 问题：
  - 路由环问题
  - 计数到无穷问题
  - 收敛慢问题
- 解决方法：
  - 水平分割
  - 毒性逆转
  - 抑制定时器
  - 触发更新

##### 链路状态路由（LS）
1. 主要思想：
  - **发现**它的邻居节点们，了解它们的网络地址
  - **设置**到它的每个邻居的成本度量
  - **构造**一个分组，包含它所了解到的所有信息
  - **发送**这个分组给所有其他的路由器
  - **计算**到每个路由器的最短路径
2. 过程
  - 发现邻居节点（发送Hello分组，收到Hello分组的回送应答，应答中包含它自己的名字）
  - 设置链路成本（发送Echo分组，另一端回送一个回答，获得合理的延迟估计值）（或者设置为与链路带宽成反比）
  - 构造链路状态分组（周期构造并发送，或者有特别事件发生时）：
    - 发送方的标识
    - 序列号
    - 年龄
    - 邻居列表
    - 到邻居的成本/量度
3. 问题
  - 序列号回转，引起新老分组识别混淆
    - 解决方案，使用32-bits的序列号，每秒产生一个分组也需要137年才发生号码回转
    - 引入新问题：若路由器崩溃，序列号记录丢失，从0开始会导致新分组被拒绝；若序列号被破坏也会导致新分组被当成旧分组拒绝
  - 路由器崩溃和序列号损坏
    - 每个分组的序列号之后是年龄，并且每秒钟年龄减1，年龄为0时该路由器信息被丢弃
4. 提高算法健壮性
  - 设置保留区，不在包到来时马上处理
5. 优点：
  - 每个路由器认识一致
  - 收敛快
  - 适合在大型网络中使用
6. 缺点
  - 每个路由器需要较大的存储空间
  - 计算负担大
7. 实例：开放最短路径优先（OSPF）

###### 开放最短路径优先（OSPF）
1. 基本概念
  - OSPF使用带宽作为度量值（10^8 / 带宽）
  - 必须划分区域，Area 0作为骨干区域，所有子区域必须连接到区域0上
  - **IP头中代表OSPF报文的协议号为89，且TTL=1，因为OSPF报文通常只在该区域内流通，不经过转发**
2. OSPF分组类型
  - Hello报文：与邻居**建立和维护**毗邻关系
  - 数据库描述（DD）：描述一个OSPF路由器的链路状态数据库内容
  - 链路状态请求（LSR）：请求相邻路由器发送其链路状态数据库中的具体条目
  - 链路状态更新（LSU）：向邻居路由器发送链路状态通告
  - 链路状态确认（LSA）：确认收到了邻居路由器的LSU
3. OSPF运行步骤
  - 建立路由器毗邻关系
  - 选举DR和BDR
  - 发现路由
  - 选择最佳路由
  - 维护路由信息
4. OSPF状态
  - Down
  - Init（初始）
  - Two-way（双向）
  - EXStart（准启动）
  - Exchange（交换）
  - Loading（加载）
  - Full adjacency（全毗邻）
5. 维护路由信息
  - 触发更新，LSU
  - Hello分组每隔10秒发送一次，失效时间为40秒
  - 即使拓扑无变化，LSA在条目过期后，发送LSU，通告链路存活
6. 问题：
  - LSDB庞大，占用大量存储空间
  - 计算最小生成树耗时增加（一点变化都会引发从头重新计算），CPU负担重
  - 网络拓扑经常变化，网络处于“动荡”之中

##### 外部网关路由协议（BGP）
- BGP运行在AS（自治系统）之间，BGP路由器对之间通过TCP连接相互通信
- 是一个克服了路由环的DV协议
- BGP路由器记录全路径信息而不仅仅是路径代价

### 流量整形
- 调节数据传输的平均速率
- 算法
  - 漏桶
  - 令牌桶
  - 其他：资源预留、准入控制、分组调度等

#### 令牌桶算法
- 设突发时间S秒、令牌桶容量B字节、令牌到达的速率R字节/秒、最大输出速率M字节/秒，则
$$
B+RS=MS
$$
得
$$
S=B/(M-R)
$$

### IP协议
1. 目的：IP的任务是提供一种尽力传送的方法，将数据报从源传送到目的（尽力而为）
2. 路由表：主要包括网络地址、接口、代价、子网掩码、网关等等
3. **IP分组格式**

#### IPv4
1. IPv4分组格式
2. 分片机制
  - 当数据报大小大于信道的MTU时，实行分片
  - 重组只在信宿机完成，减轻网关的负担，简化路由协议
  - 接收端设置重组计时器，接收到数据报的第一片时立即启动计时，规定时间内未接收到所有分片则视为接受失败
3. IP地址的分类：ABCDE5类地址
  - A类：以 0 开头，网络位总共8位（0~127）
  - B类：以 10 开头，网络位总共16位（128~191）
  - C类：以 110 开头，网络位总共24位（192~223）
  - D类：以 1110 开头（224.0.0.0 ~ 239.0.0.0）
  - E类：以 1111 开头（240.0.0.0 ~ 254.0.0.0）
4. IP地址的分配机构：ICANN，互联网名字与编号分配机构
5. 特殊的IP地址：
  - 0.0.0.0：默认路由，由主机在启动时使用
  - 255.255.255.255：标识网络中所有主机
  - 127.xx.yy.zz：用于环回测试
  - 127.0.0.1：环回地址
  - 169.254.x.x：非正常地址
6. 三种私人地址：
  - A：10.0.0.0 - 10.255.255.255
  - B：172.16.0.0 - 172.31.255.255
  - C：192.168.0.0 - 192.168.255.255
7. 子网掩码（可变长子网掩码，VLSM）
8. 危机：
  - 地址危机
  - 路由表膨胀
  - 移动性支持不够
  - QoS和性能问题

#### IPv6
1. IPv6分组格式
2. IPv6地址（冒分十六进制）
  - 在一组内可忽略前导0
  - 16个0构成的一个或多个组可以用一对冒号来代替（整个地址中只能出现一次）
3. 特殊地址：
  - ::/128：未指定
  - ::1/128：环回地址
  - **FF00::/8（11111111）：组播地址**
  - **FE80::/10（1111111010）：链路本地地址**
  - **FEC0::/10（1111111011）：网点本地地址（与IPv4私人地址相似）**
4. 链路本地地址：
  - 节点启动时，自动配置一个本地链路地址
  - 前64位：FE80:0:0:0
  - 后64位：EUI-64地址（MAC地址正中间插入11111111 11111110）
5. IPv6兼容地址：0:0:0:0:0:0:w.x.y.z
6. IPv4映射地址：0:0:0:0:0:FFFF:w.x.y.z

### 无类别域间路由CIDR
- 缓解了地址枯竭的趋势；控制甚至缩减了路由表的开销
- 最长地址前缀匹配
- 路由聚合

### 网络地址转换NAT
- 一个IP地址耗尽的快速修补方案
- 问题
  - NAT违背了IP的结构模型——每个IP地址唯一地标识了一台机器
  - NAT将互联网改变成了“面向连接”的网络
  - NAT违背了最基本的协议分层原则
  - 如果传输层不采用TCP或UDP，NAT将不再工作

### Internet消息控制协议ICMP
1. ICMP消息格式：
  - 第一个字节：类型（type）（Echo，Time Exceed...）
  - 第二个字节：代码（code）（具体问题）
  - 第三、四个字节：校验和（checksum）

### 地址解析协议ARP
1. IP地址 → MAC地址
2. 类型：
  - ARP请求（Request）
  - ARP应答（Reply）
  - 免费ARP

### 动态主机配置协议DHCP
- 灵活分配IP地址，节约IP地址的使用

# 第六章

### 传输层
1. 概述
 - 传输层是整个协议栈（TCP/IP）的核心
 - 传输层的任务是提供**可靠的、高效的**数据传输
2. 地位：向上提供标准的传输服务，向下屏蔽不同的通信子网
3. 服务：
  - 面向连接的服务
  - 无连接的服务
4. 传输层协议
  - UDP
  - TCP

### UDP（用户数据报协议）（协议号17）
- UDP是一个无连接的传输层协议，简洁高效
- UDP传输数据段，无需建立连接
- UDP数据段包括8字节的头部和数据两个部分
  - 其中的长度域表示的长度包括**头部和数据总共的长度**
  - 校验和可选，不计算校验和则该域置为0（互联网校验和）
- **UDP头部格式**

### 端口（port）
- 16位，共有65536个端口
- 端口范围：0 ~ 65535
  - < 1023：用于公共应用，由IANA分配
  - 1024 ~ 49151：用户端口，注册端口（11000...）
  - \> 49152：动态端口，私人端口
- 一些知名端口号
  - 21：FTP
  - 23：Telnet
  - 80：HTTP
  - 443：HTTPS

### TCP（传输控制协议）（协议号6）
1. TCP是专门为了在不可靠的互联网络上提供可靠的端到端**字节流**而设计的
2. 所有的TCP连接是全双工的（同时双向传输）和端到端的（每条连接只有两个端点）
3. 通信五元组：协议、本地地址、本地端口号、远端地址、远端端口号
4. TCP头部为20字节（不包括可选项）
5. TCP使用的基本协议是具有动态窗口大小的滑动窗口协议
6. **TCP数据段格式**（TCP中的ACK字段指明期望接收的字节号）（区别1位滑动窗口协议）
  - TCP段头长度以4字节为单位
  - URG为紧急指针标识，表名有紧急数据，必须首先处理（win=0也可以）
  - ACK为1标识确认号有效，为0表示无效
  - PSH表示这个数据直接送到上层，不需要缓存
  - RST用于重置一个已经混乱的连接
  - SYN用于连接建立的过程：SYN=1，ACK=0，连接请求；SYN=1，ACK=1，连接接受
  - FIN用户释放连接，表示发送方没有数据要传输了，但是可以继续接收数据
7. 三次握手建立连接
8. 释放连接
  - 为避免两军对垒问题，使用定时器
    - 若乙方发送了FIN数据段却在设定的时间内没有收到应答，则释放连接
    - 另一方最终会注意到连接的对方已经不再了，超时后连接释放
  - 杀死半开放连接的方式
    - 如果在一定时间内没有TPDU到达的话，连接自动释放
    - 传输实体在发送TPDU时要启动定时器，定时器超期将发送一个哑TPDU（dummy TPDU）维持连接
9. Nagle算法：
  - 当数据以一次一字节的速度到达时，只发送第一个字节，其他缓存，直到发出的字节得到确认
  - 将缓存起来的字节在一个数据段中发出，再继续缓存
10. 傻瓜窗口综合症
  - 发生条件：数据以大块形式传输给发送端，而发送端实体每次只读取一个字节数据
  - Clark解决方案：阻止接收方发送只有一个字节的窗口更新，等待一段时间当有了一定数量的空间再告诉发送方
11. 拥塞控制
  - TCP维持一个拥塞窗口反映网络目前的容量，发送方发送一个发送窗口，发送窗口为前两个窗口中小的那个
  - 慢启动算法
    - 使用当前最大数据段长度初始化拥塞窗口
    - 发送未超时，拥塞窗口翻倍（若到达阈值则线性增长）；若超时，将阈值设置为当前拥塞窗口的一半，拥塞窗口在此设置为最大数据段长
    - 快速恢复：超时时直接将拥塞窗口设置为阈值
    - 若收到ICMP抑制分组当做超时对待
12. **定时器管理**
  - 重传定时器：当发送一个段时，启动该定时器，在定时器时间内未收到确认则启动重传
  - 持续定时器：等待接收方更新接受窗口时，接收窗口的更新包丢失了，持续定时器超时后会发送一个探测数据段，请求当前的发送窗口值，解除死锁
  - 保活计时器：当保活计时器超时，检查连接是否存活，若果不存活则杀死连接
  - 关闭时刻处于TIME WAIT状态的定时器：运行两倍的最大分组生存时间，以确保连接关闭后该连接上所有分组都完全消失

# 第七章
###  域名系统（DNS）
- 命名层次由ICANN管理
- DNS基于UDP，当分组过长时会使用TCP，或者是从服务器更新数据时会使用TCP
- 顶级域有两种：通用域和国家域
- 域名是大小写无关的，组成各部分的名字最多有63个字符长，整个路径不超过255个字符
- DNS的主要功能是将域名映射到资源记录上
- 资源记录：
  - 域名（指出这条记录适用于哪个域）
  - 生存期（指示该条记录的稳定程度）
  - 类别（对于互联网信息，它总是IN）
  - 类型（Type，指出这是什么类型的记录）
  - 值
- 全球有13个根域服务器，名字为 a to m（a.rootservers.net）
- 域名解析的种类
  - 递归查询：主机向本地域名服务器的查询一般采用递归查询
  - 迭代查询：本地域名服务器向根域名服务器的查询通常是采用迭代查询

### 电子邮件
1. 组成部分：
  - 用户代理UA（邮件消息准备和创建信封）
  - 消息传输代理MTA（将消息从源端送到目标端）
2. 消息格式：
  - 通常采用ASCII文本
  - MIME-多用途互联网邮件扩展（在消息体重增加了结构，且为非ASCII消息定义了编码规则，如Base64）
3. 消息传输：
  - SMTP
    - 源机与目标机（SMTP守护进程在监听）的25端口建立TCP连接
    - 如果消息不能投递则向消息发送方返回一个错误报告
4. SMTP的问题：
  - 没有认证
  - 传输的是ASCII消息而不是二进制数据，需要编码，效率低下
  - 邮件是明文
5. POP3协议：在ISP的一台机器上运行消息代理，利用POP3从UA与传输代理MTA联系，拷贝到用户（连接在110端口）
  - 状态：授权、事务、更新
6. IMAP协议：提供更多命令，并且可以接收外发的邮件，在143端口监听

### 万维网（WWW）
- 万维网主要由资源、统一资源定位符和传输协议构成
- TCP移交：将TCP端点从前端传递给处理节点
- 代理服务器（高速缓存）：将最近的一些请求和响应暂存
- Cookie

### 文件传输
- FTP工作于20、21端口

### 远程登录
- telnet工作于23端口 
